function toggleLoading(t){const c=document.getElementsByClassName("lbcg-parent");for(let e=0;e<c.length;e++)!0===t?c[e].classList.add("lbcg-loading"):c[e].classList.remove("lbcg-loading")}function setCardCheckedState(){var e=document.getElementById("bc-pn");if(e){var t=JSON.parse(localStorage.getItem("pn-"+e.value))||[];for(const c in t){const n=document.querySelector('div.lbcg-card-col[data-key="'+c+'"]');n&&t[c]&&n.classList.add("lbcg-card-col-checked")}}}function checkSmallWordInGrid(t){let c=0,n=0,a=!1;for(let e=0;e<t.length;e++)t[e].innerHTML.length>n&&(n=t[e].innerHTML.length,c=e),(t[e].offsetHeight>t[e].parentNode.offsetHeight||t[e].scrollWidth>t[e].offsetWidth)&&(a=!0);let e=!1,l=getComputedStyle(document.documentElement).getPropertyValue("--lbcg-grid-font-size"),r=t[0].parentNode.offsetHeight,o=.71*r,d,s;for(l=parseFloat(l.split("px")[0]);t[c].offsetHeight<=t[c].parentNode.offsetHeight&&t[c].scrollWidth<=t[c].offsetWidth&&l<o&&l<lbcgFontSize;)if(d=t[c].offsetHeight,s=t[c].scrollWidth,document.documentElement.style.setProperty("--lbcg-grid-font-size",(l+=.5)+"px"),e=!0,d===t[c].offsetHeight&&s===t[c].scrollWidth||l<0){document.documentElement.style.setProperty("--lbcg-grid-font-size",(l-=.5)+"px");break}return e?(document.documentElement.style.setProperty("--lbcg-grid-font-size",l-.5+"px"),!0):a}function isSingleWordWrapped(e,t){return-1===e.innerText.trim().indexOf(" ")&&e.offsetHeight>1.5*t}function checkWrapWordInGrid(o,d){if(d){d=document.getElementById("lbcg-wrap-words-check");let t;t=d?d.checked:"break-word"===getComputedStyle(document.documentElement).getPropertyValue("--lbcg-grid-wrap-words").trim();let c=!1,n=getComputedStyle(document.documentElement).getPropertyValue("--lbcg-grid-font-size"),e=o[0].parentNode.offsetHeight,a=.71*e,l,r;n=parseFloat(n.split("px")[0]);for(let e=0;e<o.length;e++){for(;o[e].offsetHeight>o[e].parentNode.offsetHeight||o[e].scrollWidth>o[e].offsetWidth||n>a;)if(l=o[e].offsetHeight,r=o[e].scrollWidth,document.documentElement.style.setProperty("--lbcg-grid-font-size",(n-=.5)+"px"),c=!0,l===o[e].offsetHeight&&r===o[e].scrollWidth||n<0){document.documentElement.style.setProperty("--lbcg-grid-font-size",(n+=.5)+"px");break}for(;t&&isSingleWordWrapped(o[e],n);)document.documentElement.style.setProperty("--lbcg-grid-font-size",(n-=.5)+"px"),c=!0;setTimeout(()=>{for(;o[e].offsetHeight>o[e].parentNode.offsetHeight||o[e].scrollWidth>o[e].offsetWidth||n>a;)if(l=o[e].offsetHeight,r=o[e].scrollWidth,document.documentElement.style.setProperty("--lbcg-grid-font-size",(n-=.5)+"px"),c=!0,l===o[e].offsetHeight&&r===o[e].scrollWidth||n<0){document.documentElement.style.setProperty("--lbcg-grid-font-size",(n+=.5)+"px");break}for(;t&&isSingleWordWrapped(o[e],n);)document.documentElement.style.setProperty("--lbcg-grid-font-size",(n-=.5)+"px"),c=!0},10)}return c}{let e=!1,t=getComputedStyle(document.documentElement).getPropertyValue("--lbcg-grid-font-size"),c=o[0].parentNode.offsetHeight,n=.71*c;for(t=parseFloat(t.split("px")[0]);t>n;)document.documentElement.style.setProperty("--lbcg-grid-font-size",(t-=.5)+"px"),e=!0;return e}}function checkGridFontSize(){toggleLoading(!0);var e=document.getElementsByName("bingo_card_type")[0].value;if("1-75"!==e&&"1-90"!==e){const r=document.getElementById("lbcg-body-content"),o=document.getElementsByClassName("lbcg-card-text");if(r&&o.length){var a=r.value.split("\n"),l=Math.ceil(a.length/o.length);window.lbcgFontSize=100;let e,t,c,n;for(t=0;t<l;t++){for(e=0;e<o.length;e++)(c=t*o.length+e)in a&&(o[e].innerHTML=a[c]);n=checkSmallWordInGrid(o),checkWrapWordInGrid(o,n),window.lbcgFontSize=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--lbcg-grid-font-size").split("px")[0])}for(e=0;e<o.length;e++)o[e].innerHTML=a[e];document.getElementsByName("lbcg_font_size")[0].value=window.lbcgFontSize}}toggleLoading(!1)}document.addEventListener("DOMContentLoaded",function(){function d(){const e=document.getElementById("lbcg-body-content").value.split("\n"),t=document.getElementById("lbcg-grid-size").value,c=document.getElementsByName("bingo_card_type")[0].value;if("1-75"===c||"1-90"===c)return"";let n=25;return"3x3"===t?n=9:"4x4"===t&&(n=16),e.filter(e=>""!==e).length<n?"Please fill minimum "+n+" words/emojis or numbers, each in new line.":""}checkGridFontSize(),setCardCheckedState(),document.addEventListener("click",function(c){if(c.target.matches(".remove-bc-image")){c.preventDefault();var e=c.target.getAttribute("data-bct");document.getElementById("bc-"+e+"-image").value="",document.getElementsByName("bc_"+e+"[remove_image]")[0].value=1,document.documentElement.style.setProperty("--lbcg-"+e+"-bg-image","none")}else if(c.target.matches("#lbcg-view-all-cards")){c.preventDefault();const t=document.getElementById("lbcg-cards-custom-count");var n=parseInt(t.value);(isNaN(n)||n<=0)&&(t.disabled=!0),document.forms["lbcg-view-all-cards-form"].submit(),t.disabled=!1}else if(c.target.matches("div.lbcg-card-col")||c.target.matches("span.lbcg-card-text")||c.target.matches("span.lbcg-card-text img")){let e=c.target;c.target.matches("span.lbcg-card-text")?e=e.parentNode:c.target.matches("span.lbcg-card-text img")&&(e=e.parentNode.parentNode);let t=!1;e.classList.contains("lbcg-card-col-checked")?e.classList.remove("lbcg-card-col-checked"):e.children[0].hasChildNodes()&&(e.classList.add("lbcg-card-col-checked"),t=!0);n=document.getElementById("bc-pn");if(n){const a=JSON.parse(localStorage.getItem("pn-"+n.value))||[],l=parseInt(e.getAttribute("data-key"));isNaN(l)||(a[l]=t),localStorage.setItem("pn-"+n.value,JSON.stringify(a))}}else if(c.target.matches("span.lbcg-sidebar-arrow")){const r=c.target.parentNode.parentNode;r.classList.contains("collapsed")?r.classList.remove("collapsed"):r.classList.add("collapsed")}else(c.target.matches(".lbcg-card-preview-hover")||c.target.matches(".lbcg-card-preview-hover-text"))&&c.target.parentNode.remove()}),document.addEventListener("input",function(t){if(t.target.matches("#lbcg-title"))document.querySelector("div.lbcg-card-header span.lbcg-card-header-text").innerHTML=t.target.value;else if(t.target.matches("#lbcg-body-content")){toggleLoading(!0);var c=d();const n=t.target.value.split("\n"),a=document.querySelectorAll("div.lbcg-card-body-grid span.lbcg-card-text"),l=document.getElementById("lbcg-free-space-check").checked;for(let e=1,t=1;e<=a.length;t++)Math.round(a.length/2)===e&&l?(a[e-1].innerHTML=LBCG.freeSquareWord,e++):(""!==c||void 0!==n[t-1]&&""!==n[t-1])&&(a[e-1].innerHTML=void 0===n[t-1]?"":n[t-1],e++);checkGridFontSize()}else if(t.target.matches("#lbcg-subtitle")){const r=""!==t.target.value?t.target.value.split(""):[];let e="";switch(r.length){case 4:case 3:e="<span></span>";break;case 2:case 1:e="<span></span><span></span>"}document.getElementsByClassName("lbcg-card-subtitle-text")[0].innerHTML=e+(r.length?"<span>"+r.join("</span><span>")+"</span>":"")+e}}),document.addEventListener("change",function(t){if(t.target.matches("#lbcg-grid-size")){const c=document.getElementById("lbcg-free-space-check");"4x4"===t.target.value?(window.LBCIncludeFreeSpace=c.checked,c.checked=!1,c.parentNode.style.display="none"):(c.checked=window.LBCIncludeFreeSpace,c.parentNode.style.display="");let e;e=document.getElementById("lbcg-wrap-words-check").checked?1:"1-90"===document.getElementsByName("bingo_card_type")[0].value?"33.3px":"3x3"===t.target.value?"102px":"4x4"===t.target.value?"76.25px":"60.8px";const n=document.getElementById("content-items-count");n&&(n.innerText="3x3"===t.target.value?9:"4x4"===t.target.value?16:25);const a=document.getElementsByName("bingo_grid_size")[0];a&&(a.value=t.target.value),document.documentElement.style.setProperty("--lbcg-grid-line-height",e),function(){var c=d(),e=document.getElementById("lbcg-grid-size").value[0],n=document.getElementById("lbcg-body-content").value.split("\n"),a=document.getElementById("lbcg-free-space-check").checked,l=e**2;let r="";for(let e=1,t=1;e<=l;t++)(""!==c||void 0!==n[t-1]&&""!==n[t-1])&&(r+='<div class="lbcg-card-col"><span class="lbcg-card-text">'+(Math.round(l/2)===e&&a?LBCG.freeSquareWord:void 0===n[t-1]?"":n[t-1])+"</span></div>",e++);const t=document.querySelector("div.lbcg-card-body-grid"),o=Math.sqrt(document.querySelectorAll("div.lbcg-card-body-grid span.lbcg-card-text").length);t.classList.remove("lbcg-grid-"+o),t.classList.add("lbcg-grid-"+e),t.innerHTML=r}(),checkGridFontSize()}else if(t.target.matches("#lbcg-font"))document.documentElement.style.setProperty("--lbcg-header-font-family",LBCG.fonts[t.target.value].name+", sans-serif"),document.documentElement.style.setProperty("--lbcg-grid-font-family",LBCG.fonts[t.target.value].name+", sans-serif"),checkGridFontSize();else if(t.target.matches("#lbcg-free-space-check"))!function(e){const t=document.querySelectorAll("div.lbcg-card-body-grid span.lbcg-card-text"),c=Math.round(t.length/2)-1;e?(t[c].innerHTML=LBCG.freeSquareWord,t[c].parentNode.classList.add("lbcg-free-space")):(e=document.getElementById("lbcg-body-content").value.split("\n"),t[c].innerHTML="1-75"===document.getElementsByName("bingo_card_type")[0].value?33:e[c],t[c].parentNode.classList.remove("lbcg-free-space"))}(t.target.checked);else if(t.target.matches("#lbcg-cards-custom-count")){var e=parseInt(t.target.value);document.getElementById("lbcg-cards-count").disabled=0<e}else if(t.target.matches("#lbcg-wrap-words-check")){let e;e=t.target.checked?1:(t=document.getElementById("lbcg-grid-size").value,"1-90"===document.getElementsByName("bingo_card_type")[0].value?"33.3px":"3x3"===t?"102px":"4x4"===t?"76.25px":"60.8px"),document.documentElement.style.setProperty("--lbcg-grid-line-height",e),checkGridFontSize()}}),document.addEventListener("submit",function(c){if(c.target.matches("#lbcg-bc-generation")){c.preventDefault();const n=[...document.querySelectorAll('#lbcg-bc-generation button[type="submit"]')];n.forEach(e=>e.disabled=!0),[...document.getElementsByClassName("lbcg-card-col-checked")].forEach(e=>e.classList.remove("lbcg-card-col-checked")),html2canvas(document.getElementsByClassName("lbcg-card")[0]).then(function(e){document.getElementsByName("bc_thumbnail")[0].value=e.toDataURL(),toggleLoading(!0),n.forEach(e=>e.disabled=!1);e=d();if(""!==e)return alert(e),!1;e=new FormData(c.target);const t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){const e=JSON.parse(t.responseText);!0===e.success?location.replace(e.redirectTo):(alert(e.errors.join("\n")),toggleLoading(!1))}},t.open(c.target.method,LBCG.ajaxUrl,!0),t.send(e)})}else if(c.target.matches("#lbcg-bc-invitation")){c.preventDefault();const a=document.querySelector('#lbcg-bc-invitation button[type="submit"]');a.disabled=!0,[...document.getElementsByClassName("lbcg-card-col-checked")].forEach(e=>e.classList.remove("lbcg-card-col-checked")),html2canvas(document.getElementsByClassName("lbcg-card")[0]).then(function(e){document.getElementsByName("bingo_card_thumb")[0].value=e.toDataURL(),toggleLoading(!0),a.disabled=!1;e=new FormData(c.target);const t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){const e=JSON.parse(t.responseText);!0===e.success?0<e.failedInvites.length?alert("Invitation finished. Failed to invite them: "+e.failedInvites.join(", ")+"."):alert("Invitation finished successfully."):alert(e.errors.join("\n")),toggleLoading(!1)}},t.open(c.target.method,LBCG.ajaxUrl,!0),t.send(e)})}}),document.addEventListener("change",function(e){var t,c,n,a;e.target.matches(".bc-font-color")?(t=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+t+"-text-color",e.target.value)):e.target.matches(".bc-border-color")?(t=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+t+"-border-color",e.target.value)):e.target.matches(".bc-color")?(c=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+c+"-bg-color",e.target.value)):e.target.matches(".bc-image")?(c=e.target.getAttribute("data-bct"),document.getElementsByName("bc_"+c+"[remove_image]")[0].value="0",document.documentElement.style.setProperty("--lbcg-"+c+"-bg-image","url("+URL.createObjectURL(e.target.files[0])+")")):e.target.matches(".bc-pos")?(n=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+n+"-bg-pos",e.target.value)):e.target.matches(".bc-repeat")?(n=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+n+"-bg-repeat",e.target.value)):e.target.matches(".bc-size")?(a=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+a+"-bg-size",e.target.value)):e.target.matches(".bc-opacity")&&(a=e.target.getAttribute("data-bct"),document.documentElement.style.setProperty("--lbcg-"+a+"-bg-opacity",e.target.value/100))})});